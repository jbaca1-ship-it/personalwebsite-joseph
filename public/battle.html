<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Total War Battle - Strategy Game</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Arial", sans-serif;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        color: #fff;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }

      #gameContainer {
        display: flex;
        gap: 20px;
        max-width: 1600px;
        width: 100%;
        padding: 20px;
        height: 100%;
        align-items: flex-start;
      }

      #battleCanvas {
        border: 3px solid #4a90e2;
        background: #2d4a3e;
        border-radius: 8px;
        box-shadow: 0 0 30px rgba(74, 144, 226, 0.3);
        cursor: crosshair;
        flex-shrink: 0;
      }

      #sidePanel {
        width: 300px;
        max-height: 700px;
        background: rgba(22, 33, 62, 0.9);
        border: 2px solid #4a90e2;
        border-radius: 8px;
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 15px;
        overflow-y: auto;
        overflow-x: hidden;
      }

      .panel-section {
        background: rgba(74, 144, 226, 0.1);
        padding: 15px;
        border-radius: 6px;
        border: 1px solid rgba(74, 144, 226, 0.3);
      }

      .panel-section h3 {
        color: #4a90e2;
        margin-bottom: 10px;
        font-size: 16px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .stat-row {
        display: flex;
        justify-content: space-between;
        margin: 8px 0;
        font-size: 14px;
      }

      .stat-label {
        color: #aaa;
      }

      .stat-value {
        color: #fff;
        font-weight: bold;
      }

      .unit-info {
        font-size: 13px;
        line-height: 1.6;
        min-height: 60px;
        max-height: 200px;
        overflow-y: auto;
      }

      #backButton {
        padding: 12px;
        background: #4a90e2;
        border: none;
        border-radius: 6px;
        color: white;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      #backButton:hover {
        background: #357abd;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(74, 144, 226, 0.4);
      }

      /* Army Selection Overlay */
      #armySelectionOverlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      #armySelectionOverlay.hidden {
        display: none;
      }

      .selection-container {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        border: 3px solid #4a90e2;
        border-radius: 12px;
        padding: 40px;
        max-width: 800px;
        width: 90%;
        box-shadow: 0 0 50px rgba(74, 144, 226, 0.5);
      }

      .selection-container h2 {
        text-align: center;
        color: #4a90e2;
        margin-bottom: 20px;
        font-size: 32px;
        text-transform: uppercase;
        letter-spacing: 2px;
      }

      .budget-display {
        text-align: center;
        font-size: 24px;
        margin-bottom: 30px;
        color: #fff;
      }

      .budget-remaining {
        color: #4a90e2;
        font-weight: bold;
      }

      .unit-selector {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        margin-bottom: 30px;
      }

      .unit-option {
        background: rgba(74, 144, 226, 0.1);
        border: 2px solid #4a90e2;
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        transition: all 0.3s;
      }

      .unit-option:hover {
        background: rgba(74, 144, 226, 0.2);
        transform: translateY(-5px);
      }

      .unit-icon {
        font-size: 48px;
        margin-bottom: 10px;
      }

      .unit-option h4 {
        color: #4a90e2;
        margin-bottom: 10px;
        font-size: 18px;
      }

      .unit-option p {
        font-size: 12px;
        color: #aaa;
        margin: 5px 0;
      }

      .unit-counter {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 15px;
        margin-top: 15px;
      }

      .counter-btn {
        width: 35px;
        height: 35px;
        background: #4a90e2;
        border: none;
        border-radius: 50%;
        color: white;
        font-size: 20px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .counter-btn:hover {
        background: #357abd;
        transform: scale(1.1);
      }

      .counter-btn:disabled {
        background: #555;
        cursor: not-allowed;
        opacity: 0.5;
      }

      .counter-value {
        font-size: 24px;
        font-weight: bold;
        min-width: 40px;
      }

      #startBattleBtn {
        width: 100%;
        padding: 18px;
        background: linear-gradient(135deg, #4a90e2, #357abd);
        border: none;
        border-radius: 8px;
        color: white;
        font-size: 20px;
        cursor: pointer;
        transition: all 0.3s;
        text-transform: uppercase;
        letter-spacing: 2px;
        font-weight: bold;
      }

      #startBattleBtn:hover:not(:disabled) {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(74, 144, 226, 0.6);
      }

      #startBattleBtn:disabled {
        background: #555;
        cursor: not-allowed;
        opacity: 0.5;
      }

      /* Victory Overlay */
      #victoryOverlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      #victoryOverlay.hidden {
        display: none;
      }

      .victory-container {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        border: 3px solid #4a90e2;
        border-radius: 12px;
        padding: 40px;
        max-width: 600px;
        width: 90%;
        box-shadow: 0 0 50px rgba(74, 144, 226, 0.5);
        text-align: center;
      }

      .victory-container h2 {
        font-size: 42px;
        color: #4a90e2;
        margin-bottom: 20px;
        text-transform: uppercase;
      }

      .victory-container.defeat h2 {
        color: #e24a4a;
      }

      .score-display {
        font-size: 64px;
        color: #4a90e2;
        font-weight: bold;
        margin: 20px 0;
      }

      .battle-stats {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin: 30px 0;
      }

      .stat-box {
        background: rgba(74, 144, 226, 0.1);
        padding: 15px;
        border-radius: 6px;
        border: 1px solid rgba(74, 144, 226, 0.3);
      }

      .stat-box label {
        display: block;
        color: #aaa;
        font-size: 12px;
        margin-bottom: 5px;
        text-transform: uppercase;
      }

      .stat-box span {
        font-size: 28px;
        font-weight: bold;
        color: #fff;
      }

      #playerNameInput {
        width: 100%;
        padding: 15px;
        margin: 20px 0;
        background: rgba(74, 144, 226, 0.1);
        border: 2px solid #4a90e2;
        border-radius: 6px;
        color: white;
        font-size: 16px;
        text-align: center;
      }

      #playerNameInput::placeholder {
        color: #aaa;
      }

      .victory-buttons {
        display: flex;
        gap: 15px;
        margin-top: 20px;
      }

      .victory-btn {
        flex: 1;
        padding: 15px;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-weight: bold;
      }

      .victory-btn.primary {
        background: #4a90e2;
        color: white;
      }

      .victory-btn.primary:hover {
        background: #357abd;
        transform: translateY(-2px);
      }

      .victory-btn.secondary {
        background: rgba(74, 144, 226, 0.2);
        color: #4a90e2;
        border: 2px solid #4a90e2;
      }

      .victory-btn.secondary:hover {
        background: rgba(74, 144, 226, 0.3);
      }

      #leaderboard {
        margin-top: 30px;
        text-align: left;
      }

      #leaderboard h3 {
        color: #4a90e2;
        margin-bottom: 15px;
        text-align: center;
      }

      .leaderboard-entry {
        display: flex;
        justify-content: space-between;
        padding: 10px;
        background: rgba(74, 144, 226, 0.1);
        margin-bottom: 8px;
        border-radius: 4px;
        font-size: 14px;
      }

      .leaderboard-entry.highlight {
        background: rgba(74, 144, 226, 0.3);
        border: 2px solid #4a90e2;
      }

      .leaderboard-rank {
        color: #4a90e2;
        font-weight: bold;
        min-width: 30px;
      }

      .leaderboard-name {
        flex: 1;
        color: #fff;
      }

      .leaderboard-score {
        color: #4a90e2;
        font-weight: bold;
      }

      /* Deployment Phase UI */
      #deploymentInstructions {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(22, 33, 62, 0.95);
        border: 2px solid #4a90e2;
        border-radius: 8px;
        padding: 20px 40px;
        text-align: center;
        z-index: 100;
        box-shadow: 0 0 30px rgba(74, 144, 226, 0.5);
      }

      #deploymentInstructions.hidden {
        display: none;
      }

      #deploymentInstructions h3 {
        color: #4a90e2;
        margin-bottom: 10px;
        font-size: 20px;
      }

      #deploymentInstructions p {
        color: #aaa;
        margin-bottom: 15px;
      }

      #startCombatBtn {
        padding: 12px 30px;
        background: #4a90e2;
        border: none;
        border-radius: 6px;
        color: white;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-weight: bold;
      }

      #startCombatBtn:hover {
        background: #357abd;
        transform: translateY(-2px);
      }

      /* Unit Type Selector */
      #unitTypeSelector {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 100;
      }

      #unitTypeSelector.hidden {
        display: none;
      }

      .unit-type-buttons {
        display: flex;
        gap: 15px;
        background: rgba(22, 33, 62, 0.95);
        border: 2px solid #4a90e2;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 0 30px rgba(74, 144, 226, 0.5);
      }

      .unit-type-btn {
        background: rgba(74, 144, 226, 0.2);
        border: 2px solid #4a90e2;
        border-radius: 8px;
        padding: 15px 20px;
        cursor: pointer;
        transition: all 0.3s;
        color: white;
        min-width: 120px;
        text-align: center;
      }

      .unit-type-btn:hover:not(:disabled) {
        background: rgba(74, 144, 226, 0.4);
        transform: translateY(-3px);
        box-shadow: 0 4px 12px rgba(74, 144, 226, 0.6);
      }

      .unit-type-btn.selected {
        background: rgba(74, 144, 226, 0.6);
        border-color: #4affe2;
        box-shadow: 0 0 20px rgba(74, 255, 226, 0.5);
      }

      .unit-type-btn:disabled {
        opacity: 0.3;
        cursor: not-allowed;
        background: rgba(100, 100, 100, 0.2);
        border-color: #555;
      }

      .unit-type-icon {
        font-size: 36px;
        margin-bottom: 5px;
      }

      .unit-type-name {
        font-size: 14px;
        font-weight: bold;
        margin-bottom: 5px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .unit-type-count {
        font-size: 20px;
        color: #4a90e2;
        font-weight: bold;
      }

      .unit-type-btn.selected .unit-type-count {
        color: #4affe2;
      }

      /* Pause Button */
      #pauseBtn {
        position: fixed;
        top: 20px;
        right: 340px;
        padding: 12px 24px;
        background: rgba(74, 144, 226, 0.9);
        border: 2px solid #4a90e2;
        border-radius: 6px;
        color: white;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-weight: bold;
        z-index: 200;
      }

      #pauseBtn:hover {
        background: #357abd;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(74, 144, 226, 0.6);
      }

      /* Pause Banner */
      #pauseBanner {
        position: fixed;
        bottom: 80px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 150;
        animation: pauseBannerSlide 0.3s ease-out;
      }

      @keyframes pauseBannerSlide {
        from {
          bottom: 50px;
          opacity: 0;
        }
        to {
          bottom: 80px;
          opacity: 1;
        }
      }

      #pauseBanner.hidden {
        display: none;
      }

      .pause-banner-content {
        background: linear-gradient(
          135deg,
          rgba(74, 144, 226, 0.95),
          rgba(53, 122, 189, 0.95)
        );
        border: 2px solid #4affe2;
        border-radius: 12px;
        padding: 20px 40px;
        box-shadow: 0 8px 32px rgba(74, 144, 226, 0.6);
        backdrop-filter: blur(10px);
      }

      .pause-banner-text {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 8px;
      }

      .pause-icon {
        font-size: 28px;
      }

      .pause-title {
        font-size: 24px;
        font-weight: bold;
        color: white;
        text-transform: uppercase;
        letter-spacing: 2px;
      }

      .pause-banner-hint {
        font-size: 13px;
        color: rgba(255, 255, 255, 0.9);
        text-align: center;
      }

      kbd {
        background: rgba(74, 144, 226, 0.3);
        border: 1px solid #4a90e2;
        border-radius: 4px;
        padding: 4px 8px;
        font-family: monospace;
        font-size: 13px;
        color: #4affe2;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }
    </style>
  </head>
  <body>
    <!-- Army Selection Overlay -->
    <div id="armySelectionOverlay">
      <div class="selection-container">
        <h2>‚öîÔ∏è Build Your Army ‚öîÔ∏è</h2>
        <div class="budget-display">
          Budget Remaining:
          <span class="budget-remaining" id="budgetRemaining">1000</span>
        </div>
        <div class="unit-selector">
          <!-- Infantry -->
          <div class="unit-option">
            <div class="unit-icon">üü¶</div>
            <h4>Infantry</h4>
            <p>Cost: 50</p>
            <p>‚ù§Ô∏è Health: 100</p>
            <p>‚öîÔ∏è Damage: 15</p>
            <p>üéØ Range: 30</p>
            <p>üèÉ Speed: 2</p>
            <div class="unit-counter">
              <button
                class="counter-btn"
                onclick="battle.armySelector.decrementUnit('infantry')"
              >
                ‚àí
              </button>
              <span class="counter-value" id="infantryCount">0</span>
              <button
                class="counter-btn"
                onclick="battle.armySelector.incrementUnit('infantry')"
              >
                +
              </button>
            </div>
          </div>

          <!-- Archers -->
          <div class="unit-option">
            <div class="unit-icon">üî∫</div>
            <h4>Archers</h4>
            <p>Cost: 75</p>
            <p>‚ù§Ô∏è Health: 60</p>
            <p>‚öîÔ∏è Damage: 20</p>
            <p>üéØ Range: 150</p>
            <p>üèÉ Speed: 1.5</p>
            <div class="unit-counter">
              <button
                class="counter-btn"
                onclick="battle.armySelector.decrementUnit('archers')"
              >
                ‚àí
              </button>
              <span class="counter-value" id="archersCount">0</span>
              <button
                class="counter-btn"
                onclick="battle.armySelector.incrementUnit('archers')"
              >
                +
              </button>
            </div>
          </div>

          <!-- Cavalry -->
          <div class="unit-option">
            <div class="unit-icon">‚¨°</div>
            <h4>Cavalry</h4>
            <p>Cost: 100</p>
            <p>‚ù§Ô∏è Health: 80</p>
            <p>‚öîÔ∏è Damage: 25</p>
            <p>üéØ Range: 35</p>
            <p>üèÉ Speed: 4</p>
            <div class="unit-counter">
              <button
                class="counter-btn"
                onclick="battle.armySelector.decrementUnit('cavalry')"
              >
                ‚àí
              </button>
              <span class="counter-value" id="cavalryCount">0</span>
              <button
                class="counter-btn"
                onclick="battle.armySelector.incrementUnit('cavalry')"
              >
                +
              </button>
            </div>
          </div>
        </div>
        <button id="startBattleBtn" onclick="battle.armySelector.startBattle()">
          Start Battle
        </button>
      </div>
    </div>

    <!-- Deployment Instructions -->
    <div id="deploymentInstructions" class="hidden">
      <h3>üéØ Deploy Your Forces</h3>
      <p>Select a unit type, then click on the left side to place it</p>
      <p><span id="unitsToPlace">0</span> units remaining to place</p>
      <button
        id="startCombatBtn"
        onclick="battle.startCombat()"
        style="display: none"
      >
        Begin Combat!
      </button>
    </div>

    <!-- Unit Type Selector -->
    <div id="unitTypeSelector" class="hidden">
      <div class="unit-type-buttons">
        <button
          class="unit-type-btn"
          id="deployInfantryBtn"
          onclick="battle.selectUnitTypeToPlace('infantry')"
        >
          <div class="unit-type-icon">üü¶</div>
          <div class="unit-type-name">Infantry</div>
          <div class="unit-type-count" id="infantryRemaining">0</div>
        </button>
        <button
          class="unit-type-btn"
          id="deployArchersBtn"
          onclick="battle.selectUnitTypeToPlace('archers')"
        >
          <div class="unit-type-icon">üî∫</div>
          <div class="unit-type-name">Archers</div>
          <div class="unit-type-count" id="archersRemaining">0</div>
        </button>
        <button
          class="unit-type-btn"
          id="deployCavalryBtn"
          onclick="battle.selectUnitTypeToPlace('cavalry')"
        >
          <div class="unit-type-icon">‚¨°</div>
          <div class="unit-type-name">Cavalry</div>
          <div class="unit-type-count" id="cavalryRemaining">0</div>
        </button>
      </div>
    </div>

    <!-- Pause Button -->
    <button id="pauseBtn" onclick="battle.togglePause()" style="display: none">
      ‚è∏ Pause
    </button>

    <!-- Pause Banner -->
    <div id="pauseBanner" class="hidden">
      <div class="pause-banner-content">
        <div class="pause-banner-text">
          <span class="pause-icon">‚è∏</span>
          <span class="pause-title">GAME PAUSED</span>
        </div>
        <div class="pause-banner-hint">
          You can still select units and give orders ‚Ä¢ Press <kbd>Space</kbd> or
          <kbd>P</kbd> to resume
        </div>
      </div>
    </div>

    <!-- Victory Overlay -->
    <div id="victoryOverlay" class="hidden">
      <div class="victory-container">
        <h2 id="victoryTitle">Victory!</h2>
        <div class="score-display" id="finalScore">0</div>
        <div class="battle-stats">
          <div class="stat-box">
            <label>Enemy Kills</label>
            <span id="enemyKillsDisplay">0</span>
          </div>
          <div class="stat-box">
            <label>Your Losses</label>
            <span id="yourLossesDisplay">0</span>
          </div>
          <div class="stat-box">
            <label>Battle Time</label>
            <span id="battleTimeDisplay">0s</span>
          </div>
          <div class="stat-box">
            <label>Time Bonus</label>
            <span id="timeBonusDisplay">0</span>
          </div>
        </div>
        <input
          type="text"
          id="playerNameInput"
          placeholder="Enter your name"
          maxlength="20"
        />
        <div class="victory-buttons">
          <button class="victory-btn primary" onclick="battle.submitScore()">
            Submit Score
          </button>
          <button class="victory-btn secondary" onclick="battle.playAgain()">
            Play Again
          </button>
        </div>
        <div id="leaderboard" class="hidden">
          <h3>üèÜ Leaderboard</h3>
          <div id="leaderboardEntries"></div>
        </div>
      </div>
    </div>

    <!-- Game Container -->
    <div id="gameContainer">
      <canvas id="battleCanvas" width="1200" height="700"></canvas>
      <div id="sidePanel">
        <div class="panel-section">
          <h3>Battle Status</h3>
          <div class="stat-row">
            <span class="stat-label">Phase:</span>
            <span class="stat-value" id="phaseDisplay">Deploying</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Time:</span>
            <span class="stat-value" id="timeDisplay">0s</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Your Units:</span>
            <span class="stat-value" id="playerUnitsDisplay">0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Enemy Units:</span>
            <span class="stat-value" id="enemyUnitsDisplay">0</span>
          </div>
        </div>

        <div class="panel-section">
          <h3>Selected Unit</h3>
          <div class="unit-info" id="unitInfo">
            <p>No unit selected</p>
          </div>
        </div>

        <div class="panel-section">
          <h3>Score Tracker</h3>
          <div class="stat-row">
            <span class="stat-label">Kills:</span>
            <span class="stat-value" id="killsDisplay">0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Losses:</span>
            <span class="stat-value" id="lossesDisplay">0</span>
          </div>
        </div>

        <div class="panel-section">
          <h3>Controls</h3>
          <div style="font-size: 12px; line-height: 1.8; color: #aaa">
            <p>üñ±Ô∏è Left-click to select</p>
            <p>üñ±Ô∏è Drag to select multiple</p>
            <p>üñ±Ô∏è Left-click ground to move</p>
            <p>üñ±Ô∏è Right-click enemy to focus (+50% dmg)</p>
            <p>‚å®Ô∏è Ctrl+A - Select all</p>
            <p>‚å®Ô∏è Space/P - Pause</p>
          </div>
        </div>

        <button id="backButton" onclick="window.location.href='index.html'">
          ‚Üê Back to Home
        </button>
      </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- Game Script -->
    <script src="scripts/battle.js"></script>
  </body>
</html>
